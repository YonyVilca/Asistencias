{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Reportes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .section-nav .btn {
            min-width: 140px;
        }
        #contenedor {
            margin-top: 2rem;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">
    <h2 class="mb-4">üìä Panel de Reportes</h2>

    <!-- Navegaci√≥n de secciones -->
    <div class="section-nav d-flex gap-2">
        <button class="btn btn-primary" onclick="cargar('diario', event)">üìÖ Diario</button>
        <button class="btn btn-outline-secondary" onclick="cargar('mensual', event)">üìÜ Mensual</button>
        <button class="btn btn-outline-secondary" onclick="cargar('por_usuario', event)">üë§ Por usuario</button>
        
    </div>

    <!-- Contenedor din√°mico -->
    <div id="contenedor">
        <div class="text-muted text-center py-4">Cargando m√≥dulo...</div>
    </div>
</div>

<script>
    function cargar(seccion, evento = null) {
        const contenedor = document.getElementById('contenedor');
        contenedor.innerHTML = '<div class="text-muted text-center py-4">‚è≥ Cargando...</div>';
    
        let endpoint = '';
        if (seccion === 'diario') endpoint = '/admin/api/resumen-diario/html';
        else if (seccion === 'mensual') endpoint = '/admin/api/resumen-mensual/html';
        else if (seccion === 'por_usuario') endpoint = '/admin/api/por-usuario/html';
    
        fetch(endpoint)
            .then(res => res.text())
            .then(html => {
                contenedor.innerHTML = html;
            })
            .catch(() => {
                contenedor.innerHTML = '<div class="alert alert-danger">Error al cargar la secci√≥n.</div>';
            });
    
        // Si hay evento (por clic), actualiza botones
        if (evento) {
            document.querySelectorAll(".section-nav .btn").forEach(btn => {
                btn.classList.remove("btn-primary");
                btn.classList.add("btn-outline-secondary");
            });
            evento.target.classList.remove("btn-outline-secondary");
            evento.target.classList.add("btn-primary");
        }
    }
    
    // Cargar secci√≥n por defecto (sin evento)
    document.addEventListener("DOMContentLoaded", () => cargar('diario'));
    </script>
    

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    document.addEventListener("change", function(e) {
        const contenedorUsuario = document.getElementById("tabla-asistencias-usuario");
    
        // Cambio en el selector de mes del resumen mensual
        if (e.target && e.target.id === "selector-mes") {
            const mes = e.target.value;
            const contenedor = e.target.closest(".card").parentElement;
    
            contenedor.innerHTML = '<div class="text-center text-muted p-4">‚è≥ Cargando resumen...</div>';
    
            fetch(`/admin/api/resumen-mensual/html?mes=${mes}`)
                .then(res => res.text())
                .then(html => contenedor.innerHTML = html)
                .catch(() => contenedor.innerHTML = '<div class="alert alert-danger">Error al cargar resumen mensual.</div>');
        }
    
        // Cambio en selector de usuario o mes para "por usuario"
        if (
            (e.target && e.target.id === "usuario-select") ||
            (e.target && e.target.id === "mes-select")
        ) {
            const userSelect = document.getElementById("usuario-select");
            const mesSelect = document.getElementById("mes-select");
    
            if (!userSelect || !mesSelect || !contenedorUsuario) return;
    
            const userId = userSelect.value;
            const mes = mesSelect.value;
    
            if (!userId) {
                contenedorUsuario.innerHTML = '<div class="text-muted text-center">Seleccione un usuario para ver sus asistencias.</div>';
                return;
            }
    
            contenedorUsuario.innerHTML = '<div class="text-center text-muted">‚è≥ Cargando asistencias...</div>';
    
            fetch(`/admin/api/asistencias-usuario?usuario_id=${userId}&mes=${mes}`)
                .then(res => res.text())
                .then(html => contenedorUsuario.innerHTML = html)
                .catch(() => contenedorUsuario.innerHTML = '<div class="alert alert-danger">Error al cargar asistencias.</div>');
        }
    });
    </script>
    
    
</html>
{% endblock %}